<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCQ Quiz Pro | Test Your Knowledge</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #7209b7;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border-radius: 12px;
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            color: var(--gray);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .timer-container {
            text-align: center;
        }
        
        .timer {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .timer-warning {
            color: var(--warning);
        }
        
        .timer-danger {
            color: var(--danger);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .filters {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .filter-group {
            flex: 1;
            min-width: 150px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }
        
        select:focus, input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        button {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, var(--gray), #5a6268);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #20c997, #099268);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, var(--danger), #c2255c);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, var(--warning), #e8590c);
        }
        
        .quiz-container {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }
        
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .question-number {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .question-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .question-text {
            font-size: 1.4rem;
            margin-bottom: 25px;
            line-height: 1.7;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid var(--primary);
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }
        
        .option {
            padding: 16px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.1rem;
        }
        
        .option:hover {
            border-color: var(--primary);
            background-color: #f0f4ff;
        }
        
        .option.selected {
            border-color: var(--primary);
            background-color: #e6f0ff;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.2);
        }
        
        .option.correct {
            border-color: #20c997;
            background-color: #d4f4e9;
        }
        
        .option.incorrect {
            border-color: var(--danger);
            background-color: #fcdae4;
        }
        
        .option-marked {
            border-left: 5px solid var(--warning);
        }
        
        .option-letter {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            transition: var(--transition);
        }
        
        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }
        
        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }
        
        .left-controls, .right-controls {
            display: flex;
            gap: 10px;
        }
        
        .question-palette {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .palette-btn {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid #e9ecef;
            background: white;
        }
        
        .palette-btn.answered {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .palette-btn.marked {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }
        
        .palette-btn.current {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(114, 9, 183, 0.3);
        }
        
        .palette-btn:hover {
            transform: scale(1.1);
        }
        
        .results {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .score {
            font-size: 3.5rem;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .stat {
            padding: 25px;
            border-radius: 15px;
            background: white;
            min-width: 150px;
            box-shadow: var(--box-shadow);
        }
        
        .stat.correct {
            border-top: 5px solid #20c997;
        }
        
        .stat.incorrect {
            border-top: 5px solid var(--danger);
        }
        
        .stat.unanswered {
            border-top: 5px solid var(--gray);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat.correct .stat-value {
            color: #20c997;
        }
        
        .stat.incorrect .stat-value {
            color: var(--danger);
        }
        
        .stat.unanswered .stat-value {
            color: var(--gray);
        }
        
        .stat-label {
            font-size: 1rem;
            color: var(--gray);
            font-weight: 600;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.3rem;
            color: var(--primary);
        }
        
        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .mark-btn {
            background: transparent;
            color: var(--warning);
            border: 2px solid var(--warning);
            padding: 8px 15px;
        }
        
        .mark-btn.marked {
            background: var(--warning);
            color: white;
        }
        
        .mark-btn:hover {
            background: var(--warning);
            color: white;
        }
        
        .user-records {
            display: none;
            margin-top: 30px;
        }
        
        .records-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }
        
        .records-table th,
        .records-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .records-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }
        
        .records-table tr:hover {
            background: #f8f9fa;
        }
        
        .records-table .score-cell {
            font-weight: bold;
            text-align: center;
        }
        
        .records-table .passed {
            color: #20c997;
        }
        
        .records-table .failed {
            color: var(--danger);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: white;
            border-radius: 10px;
            padding: 5px;
            box-shadow: var(--box-shadow);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
        }
        
        .tab:hover:not(.active) {
            background: #f8f9fa;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .user-info {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .user-info input {
            flex: 1;
            min-width: 200px;
        }
        
        .empty-records {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        
        .empty-records i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-brain"></i> MCQ Quiz Pro</h1>
            <p class="subtitle">Test your knowledge with our advanced quiz platform</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="quiz">Take Quiz</div>
            <div class="tab" data-tab="records">My Records</div>
        </div>
        
        <div id="loading-message" class="loading card">
            <div class="loading-spinner"></div>
            Loading questions from database...
        </div>
        
        <div class="tab-content active" id="quiz-tab">
            <div class="dashboard" id="main-content" style="display: none;">
                <div class="card timer-container">
                    <h3><i class="fas fa-clock"></i> Time Remaining</h3>
                    <div class="timer" id="timer">10:00</div>
                    <div class="progress-bar">
                        <div class="progress" id="progress-bar"></div>
                    </div>
                    <p>Time per question: <strong>1 minute</strong></p>
                </div>
                
                <div class="card filters">
                    <h3><i class="fas fa-filter"></i> Filter Questions</h3>
                    <div class="user-info">
                        <input type="text" id="user-name" placeholder="Enter your name" required>
                        <input type="email" id="user-email" placeholder="Enter your email">
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="exam-filter"><i class="fas fa-graduation-cap"></i> Exam</label>
                            <select id="exam-filter">
                                <option value="all">All Exams</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="section-filter"><i class="fas fa-layer-group"></i> Section</label>
                            <select id="section-filter">
                                <option value="all">All Sections</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="topic-filter"><i class="fas fa-book"></i> Topic</label>
                            <select id="topic-filter">
                                <option value="all">All Topics</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="question-count"><i class="fas fa-list-ol"></i> Number of Questions</label>
                            <input type="number" id="question-count" min="1" max="50" value="10">
                        </div>
                        
                        <div class="filter-group">
                            <label>&nbsp;</label>
                            <button id="start-quiz"><i class="fas fa-play-circle"></i> Start Quiz</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="quiz-container" id="quiz-container">
                <div class="quiz-header">
                    <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">10</span></div>
                    <div class="question-meta">
                        <span><i class="fas fa-clock"></i> <span id="quiz-timer">10:00</span></span>
                        <span id="marked-status"><i class="far fa-bookmark"></i> Not Marked</span>
                    </div>
                </div>
                
                <div class="question-text" id="question-text"></div>
                
                <div class="options" id="options-container">
                    <!-- Options will be populated by JavaScript -->
                </div>
                
                <div class="quiz-controls">
                    <div class="left-controls">
                        <button id="mark-btn" class="mark-btn"><i class="far fa-bookmark"></i> Mark</button>
                        <button id="clear-btn" class="btn-secondary"><i class="fas fa-eraser"></i> Clear</button>
                    </div>
                    
                    <div class="right-controls">
                        <button id="prev-btn" class="btn-secondary"><i class="fas fa-arrow-left"></i> Previous</button>
                        <button id="next-btn" class="btn-success">Save & Next <i class="fas fa-arrow-right"></i></button>
                        <button id="submit-btn" class="btn-danger" style="display: none;"><i class="fas fa-flag-checkered"></i> Submit Quiz</button>
                    </div>
                </div>
                
                <div class="question-palette" id="question-palette">
                    <!-- Question palette will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="results card" id="results-container">
                <h2><i class="fas fa-trophy"></i> Quiz Completed!</h2>
                <div class="score">Your Score: <span id="score-value">0</span>/<span id="total-score">10</span></div>
                
                <div class="stats">
                    <div class="stat correct">
                        <div class="stat-value" id="correct-answers">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat incorrect">
                        <div class="stat-value" id="incorrect-answers">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat unanswered">
                        <div class="stat-value" id="unanswered">0</div>
                        <div class="stat-label">Unanswered</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="restart-btn" class="btn-success"><i class="fas fa-redo"></i> Take Another Quiz</button>
                    <button id="view-records-btn" class="btn-secondary"><i class="fas fa-history"></i> View My Records</button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="records-tab">
            <div class="card user-records" id="user-records">
                <h2><i class="fas fa-history"></i> My Quiz Records</h2>
                <div id="records-content">
                    <table class="records-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Exam</th>
                                <th>Score</th>
                                <th>Time Taken</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="records-table-body">
                            <!-- Records will be populated by JavaScript -->
                        </tbody>
                    </table>
                    <div id="empty-records" class="empty-records" style="display: none;">
                        <i class="fas fa-inbox"></i>
                        <h3>No Records Yet</h3>
                        <p>Take your first quiz to see your records here!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Update this path to your Excel file in GitHub
        const EXCEL_FILE_URL = 'https://raw.githubusercontent.com/Moha3233/PYQs/main/questions.xlsx';
        
        // Global variables
        let questionData = [];
        let filteredQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let markedQuestions = [];
        let timer;
        let timeLeft;
        let totalTime;
        let quizActive = false;
        let quizStartTime;
        let currentUserName = '';
        let currentUserEmail = '';

        // DOM Elements
        const loadingMessage = document.getElementById('loading-message');
        const mainContent = document.getElementById('main-content');
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');
        const timerElement = document.getElementById('timer');
        const quizTimerElement = document.getElementById('quiz-timer');
        const progressBar = document.getElementById('progress-bar');
        const startQuizBtn = document.getElementById('start-quiz');
        const examFilter = document.getElementById('exam-filter');
        const sectionFilter = document.getElementById('section-filter');
        const topicFilter = document.getElementById('topic-filter');
        const questionCountInput = document.getElementById('question-count');
        const userNameInput = document.getElementById('user-name');
        const userEmailInput = document.getElementById('user-email');
        const markBtn = document.getElementById('mark-btn');
        const clearBtn = document.getElementById('clear-btn');
        const markedStatus = document.getElementById('marked-status');
        const userRecords = document.getElementById('user-records');
        const recordsTableBody = document.getElementById('records-table-body');
        const emptyRecords = document.getElementById('empty-records');
        const viewRecordsBtn = document.getElementById('view-records-btn');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load questions automatically
            loadQuestionsAutomatically();
            
            // Set up event listeners
            startQuizBtn.addEventListener('click', startQuiz);
            viewRecordsBtn.addEventListener('click', showRecordsTab);
            
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Load user records
            loadUserRecords();
        });

        // Load questions automatically from GitHub
        async function loadQuestionsAutomatically() {
            try {
                // For demo purposes, we'll use sample data
                // In production, you would fetch from EXCEL_FILE_URL
                questionData = getSampleQuestions();
                updateFilterOptions();
                
                loadingMessage.style.display = 'none';
                mainContent.style.display = 'grid';
                
                console.log(`Successfully loaded ${questionData.length} questions`);
                
            } catch (error) {
                console.error('Error loading questions:', error);
                loadingMessage.innerHTML = `
                    <div style="color: #e74c3c;">
                        <i class="fas fa-exclamation-triangle"></i><br>
                        Error loading questions: ${error.message}<br>
                        <button onclick="loadQuestionsAutomatically()" style="margin-top: 10px;">Retry</button>
                    </div>
                `;
            }
        }

        // Sample questions for demo
        function getSampleQuestions() {
            return [
                {
                    id: 1,
                    exam: "GATE",
                    section: "Agritude",
                    topic: "Articles",
                    questionType: "MCQ",
                    question: "Even though I had planned to go skiing with my friends, I had to ______ at the last moment because of an injury.",
                    year: 2025,
                    options: ["back up", "back of", "back on", "back out"],
                    correctAnswer: "back out"
                },
                {
                    id: 2,
                    exam: "GATE",
                    section: "Agritude",
                    topic: "Articles",
                    questionType: "MCQ",
                    question: "The President, along with the Council of Ministers, ______ to visit India next week.",
                    year: 2025,
                    options: ["with", "wishes", "will wish", "is wishing"],
                    correctAnswer: "wishes"
                },
                {
                    id: 3,
                    exam: "GATE",
                    section: "Agritude",
                    topic: "Grammar",
                    questionType: "MCQ",
                    question: "Which of the following sentences is grammatically correct?",
                    year: 2024,
                    options: [
                        "Neither of the students have completed their homework.",
                        "Neither of the students has completed their homework.",
                        "Neither of the students have completed his homework.",
                        "Neither of the students has completed his homework."
                    ],
                    correctAnswer: "Neither of the students has completed his homework."
                },
                {
                    id: 4,
                    exam: "GATE",
                    section: "Agritude",
                    topic: "Vocabulary",
                    questionType: "MCQ",
                    question: "What is the meaning of the word 'ephemeral'?",
                    year: 2024,
                    options: [
                        "Lasting for a very short time",
                        "Extremely beautiful",
                        "Difficult to understand",
                        "Related to memory"
                    ],
                    correctAnswer: "Lasting for a very short time"
                },
                {
                    id: 5,
                    exam: "GATE",
                    section: "Agritude",
                    topic: "Articles",
                    questionType: "MCQ",
                    question: "Fill in the blank: I saw ______ eagle flying high in ______ sky.",
                    year: 2023,
                    options: [
                        "a, the",
                        "an, the",
                        "the, a",
                        "an, a"
                    ],
                    correctAnswer: "an, the"
                }
            ];
        }

        // Update filter dropdowns based on loaded data
        function updateFilterOptions() {
            examFilter.innerHTML = '<option value="all">All Exams</option>';
            sectionFilter.innerHTML = '<option value="all">All Sections</option>';
            topicFilter.innerHTML = '<option value="all">All Topics</option>';
            
            const exams = [...new Set(questionData.map(q => q.exam))].filter(Boolean);
            const sections = [...new Set(questionData.map(q => q.section))].filter(Boolean);
            const topics = [...new Set(questionData.map(q => q.topic))].filter(Boolean);
            
            exams.forEach(exam => {
                const option = document.createElement('option');
                option.value = exam;
                option.textContent = exam;
                examFilter.appendChild(option);
            });
            
            sections.forEach(section => {
                const option = document.createElement('option');
                option.value = section;
                option.textContent = section;
                sectionFilter.appendChild(option);
            });
            
            topics.forEach(topic => {
                const option = document.createElement('option');
                option.value = topic;
                option.textContent = topic;
                topicFilter.appendChild(option);
            });
        }

        // Switch between tabs
        function switchTab(tabName) {
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Update active content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Load records if switching to records tab
            if (tabName === 'records') {
                loadUserRecords();
            }
        }

        // Show records tab
        function showRecordsTab() {
            switchTab('records');
        }

        // Start the quiz
        function startQuiz() {
            // Validate user input
            if (!userNameInput.value.trim()) {
                alert('Please enter your name to start the quiz.');
                userNameInput.focus();
                return;
            }
            
            currentUserName = userNameInput.value.trim();
            currentUserEmail = userEmailInput.value.trim();
            
            if (questionData.length === 0) {
                alert('Questions are still loading. Please wait a moment.');
                return;
            }
            
            applyFilters();
            const questionCount = parseInt(questionCountInput.value);
            if (filteredQuestions.length === 0) {
                alert('No questions match the selected filters.');
                return;
            }
            
            filteredQuestions = filteredQuestions.slice(0, questionCount);
            userAnswers = new Array(filteredQuestions.length).fill(null);
            markedQuestions = new Array(filteredQuestions.length).fill(false);
            
            // Set up timer
            totalTime = filteredQuestions.length * 60;
            timeLeft = totalTime;
            quizStartTime = new Date();
            updateTimerDisplay();
            startTimer();
            
            // Show quiz container
            quizContainer.style.display = 'block';
            resultsContainer.style.display = 'none';
            mainContent.style.display = 'none';
            
            // Show first question
            currentQuestionIndex = 0;
            showQuestion();
            
            quizActive = true;
        }

        // Apply filters to question data
        function applyFilters() {
            const selectedExam = examFilter.value;
            const selectedSection = sectionFilter.value;
            const selectedTopic = topicFilter.value;
            
            filteredQuestions = questionData.filter(question => {
                return (selectedExam === 'all' || question.exam === selectedExam) &&
                       (selectedSection === 'all' || question.section === selectedSection) &&
                       (selectedTopic === 'all' || question.topic === selectedTopic);
            });
            
            shuffleArray(filteredQuestions);
        }

        // Shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Start the countdown timer
        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    submitQuiz();
                }
            }, 1000);
        }

        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            timerElement.textContent = timeString;
            quizTimerElement.textContent = timeString;
            
            // Update progress bar
            const progressPercentage = ((totalTime - timeLeft) / totalTime) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            
            // Change color when time is running out
            if (timeLeft < 60) {
                timerElement.className = 'timer timer-danger';
                quizTimerElement.style.color = '#f72585';
            } else if (timeLeft < 300) {
                timerElement.className = 'timer timer-warning';
                quizTimerElement.style.color = '#f8961e';
            } else {
                timerElement.className = 'timer';
                quizTimerElement.style.color = '#4361ee';
            }
        }

        // Display current question
        function showQuestion() {
            const question = filteredQuestions[currentQuestionIndex];
            
            // Update question number and marked status
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            document.getElementById('total-questions').textContent = filteredQuestions.length;
            
            // Update marked status
            updateMarkedStatus();
            
            // Update question text
            document.getElementById('question-text').textContent = question.question;
            
            // Create options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                if (userAnswers[currentQuestionIndex] === option) {
                    optionElement.classList.add('selected');
                }
                if (markedQuestions[currentQuestionIndex]) {
                    optionElement.classList.add('option-marked');
                }
                
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(option));
                optionsContainer.appendChild(optionElement);
            });
            
            // Update navigation buttons
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').style.display = currentQuestionIndex < filteredQuestions.length - 1 ? 'flex' : 'none';
            document.getElementById('submit-btn').style.display = currentQuestionIndex === filteredQuestions.length - 1 ? 'flex' : 'none';
            
            // Update question palette
            updateQuestionPalette();
            
            // Add event listeners to control buttons
            document.getElementById('prev-btn').onclick = showPreviousQuestion;
            document.getElementById('next-btn').onclick = showNextQuestion;
            document.getElementById('submit-btn').onclick = submitQuiz;
            document.getElementById('mark-btn').onclick = toggleMarkQuestion;
            document.getElementById('clear-btn').onclick = clearAnswer;
        }

        // Update marked status display
        function updateMarkedStatus() {
            if (markedQuestions[currentQuestionIndex]) {
                markBtn.innerHTML = '<i class="fas fa-bookmark"></i> Unmark';
                markBtn.classList.add('marked');
                markedStatus.innerHTML = '<i class="fas fa-bookmark"></i> Marked';
            } else {
                markBtn.innerHTML = '<i class="far fa-bookmark"></i> Mark';
                markBtn.classList.remove('marked');
                markedStatus.innerHTML = '<i class="far fa-bookmark"></i> Not Marked';
            }
        }

        // Update question palette
        function updateQuestionPalette() {
            const palette = document.getElementById('question-palette');
            palette.innerHTML = '';
            
            filteredQuestions.forEach((_, index) => {
                const btn = document.createElement('div');
                btn.className = 'palette-btn';
                
                if (index === currentQuestionIndex) {
                    btn.classList.add('current');
                }
                
                if (userAnswers[index] !== null) {
                    btn.classList.add('answered');
                }
                
                if (markedQuestions[index]) {
                    btn.classList.add('marked');
                }
                
                btn.textContent = index + 1;
                btn.addEventListener('click', () => navigateToQuestion(index));
                
                palette.appendChild(btn);
            });
        }

        // Navigate to specific question
        function navigateToQuestion(index) {
            currentQuestionIndex = index;
            showQuestion();
        }

        // Select an option
        function selectOption(option) {
            userAnswers[currentQuestionIndex] = option;
            
            // Update UI to show selected option
            const options = document.querySelectorAll('.option');
            options.forEach(opt => {
                opt.classList.remove('selected');
                if (opt.querySelector('.option-text').textContent === option) {
                    opt.classList.add('selected');
                }
            });
            
            // Update question palette
            updateQuestionPalette();
        }

        // Clear current answer
        function clearAnswer() {
            userAnswers[currentQuestionIndex] = null;
            
            // Update UI
            const options = document.querySelectorAll('.option');
            options.forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Update question palette
            updateQuestionPalette();
        }

        // Toggle mark question
        function toggleMarkQuestion() {
            markedQuestions[currentQuestionIndex] = !markedQuestions[currentQuestionIndex];
            updateMarkedStatus();
            updateQuestionPalette();
            
            // Update current question display if marked
            const options = document.querySelectorAll('.option');
            options.forEach(opt => {
                if (markedQuestions[currentQuestionIndex]) {
                    opt.classList.add('option-marked');
                } else {
                    opt.classList.remove('option-marked');
                }
            });
        }

        // Show previous question
        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        // Show next question
        function showNextQuestion() {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        // Submit the quiz
        function submitQuiz() {
            clearInterval(timer);
            quizActive = false;
            
            // Calculate time taken
            const endTime = new Date();
            const timeTaken = Math.round((endTime - quizStartTime) / 1000); // in seconds
            
            // Calculate results
            let correctCount = 0;
            let incorrectCount = 0;
            let unansweredCount = 0;
            
            filteredQuestions.forEach((question, index) => {
                if (userAnswers[index] === null) {
                    unansweredCount++;
                } else if (userAnswers[index] === question.correctAnswer) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
            });
            
            // Save quiz record
            saveQuizRecord(correctCount, timeTaken);
            
            // Display results
            document.getElementById('score-value').textContent = correctCount;
            document.getElementById('total-score').textContent = filteredQuestions.length;
            document.getElementById('correct-answers').textContent = correctCount;
            document.getElementById('incorrect-answers').textContent = incorrectCount;
            document.getElementById('unanswered').textContent = unansweredCount;
            
            // Add event listeners to result buttons
            document.getElementById('restart-btn').onclick = restartQuiz;
            
            // Show results container
            quizContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
        }

        // Save quiz record to localStorage
        function saveQuizRecord(score, timeTaken) {
            const records = getQuizRecords();
            const selectedExam = examFilter.value === 'all' ? 'Mixed' : examFilter.value;
            
            const record = {
                id: Date.now(),
                date: new Date().toLocaleString(),
                name: currentUserName,
                email: currentUserEmail,
                exam: selectedExam,
                score: score,
                total: filteredQuestions.length,
                timeTaken: formatTime(timeTaken),
                percentage: Math.round((score / filteredQuestions.length) * 100),
                status: score >= (filteredQuestions.length * 0.6) ? 'Passed' : 'Failed'
            };
            
            records.unshift(record); // Add to beginning
            localStorage.setItem('quizRecords', JSON.stringify(records));
        }

        // Get quiz records from localStorage
        function getQuizRecords() {
            const records = localStorage.getItem('quizRecords');
            return records ? JSON.parse(records) : [];
        }

        // Load and display user records
        function loadUserRecords() {
            const records = getQuizRecords();
            const tableBody = document.getElementById('records-table-body');
            
            if (records.length === 0) {
                emptyRecords.style.display = 'block';
                tableBody.innerHTML = '';
            } else {
                emptyRecords.style.display = 'none';
                tableBody.innerHTML = records.map(record => `
                    <tr>
                        <td>${record.date}</td>
                        <td>${record.name}</td>
                        <td>${record.exam}</td>
                        <td class="score-cell ${record.status.toLowerCase()}">${record.score}/${record.total} (${record.percentage}%)</td>
                        <td>${record.timeTaken}</td>
                        <td class="${record.status.toLowerCase()}">${record.status}</td>
                    </tr>
                `).join('');
            }
        }

        // Format time in seconds to MM:SS
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // Restart the quiz
        function restartQuiz() {
            resultsContainer.style.display = 'none';
            mainContent.style.display = 'grid';
            currentQuestionIndex = 0;
            userAnswers = [];
            markedQuestions = [];
        }
    </script>
</body>
</html>
